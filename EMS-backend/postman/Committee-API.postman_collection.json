{
  "info": {
    "_postman_id": "committee-api-collection",
    "name": "Committee API - EMS Backend",
    "description": "Collection for testing Committee endpoints (create committee, assign head/director, queries, and counts).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Create Committee (President only)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains committee id\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "});",
              "",
              "try {",
              "    const jsonData = pm.response.json();",
              "    if (jsonData && jsonData.id) {",
              "        pm.collectionVariables.set(\"committee_id\", String(jsonData.id));",
              "    }",
              "} catch (e) {",
              "    // ignore JSON parse errors",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{president_jwt}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Logistics Committee\",\n  \"description\": \"Handles logistics for events\",\n  \"activityId\": {{activity_id}}\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/committees",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees"
          ]
        }
      },
      "response": []
    },
    {
      "name": "2. Assign Committee Head (President only)",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{president_jwt}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{head_user_id}}"
        },
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}/head",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}",
            "head"
          ]
        }
      },
      "response": []
    },
    {
      "name": "3. Assign Committee Director (President only)",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{president_jwt}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{director_user_id}}"
        },
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}/director",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}",
            "director"
          ]
        }
      },
      "response": []
    },
    {
      "name": "4. Get Committees By Activity",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/activity/{{activity_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "activity",
            "{{activity_id}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "5. Count Committees In Activity",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/activity/{{activity_id}}/count",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "activity",
            "{{activity_id}}",
            "count"
          ]
        }
      },
      "response": []
    },
    {
      "name": "6. Get Committee By ID",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "7. Get Committees By Director",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/director/{{director_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "director",
            "{{director_id}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "8. Count Committee Members",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}/members/count",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}",
            "members",
            "count"
          ]
        }
      },
      "response": []
    },
    {
      "name": "9. Search Students (Committee Head)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains array of students\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.be.an('array');",
              "    if (jsonData.length > 0) {",
              "        pm.expect(jsonData[0]).to.have.property('id');",
              "        pm.expect(jsonData[0]).to.have.property('fullName');",
              "        pm.expect(jsonData[0]).to.have.property('email');",
              "    }",
              "});",
              "",
              "// Store first student ID for testing add member",
              "try {",
              "    const jsonData = pm.response.json();",
              "    if (jsonData && jsonData.length > 0 && jsonData[0].id) {",
              "        pm.collectionVariables.set(\"student_id\", String(jsonData[0].id));",
              "    }",
              "} catch (e) {",
              "    // ignore JSON parse errors",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{committee_head_jwt}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/search-students?query={{search_query}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "search-students"
          ],
          "query": [
            {
              "key": "query",
              "value": "{{search_query}}",
              "description": "Search by student name or ID"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "10. Add Member to Committee (Committee Head)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains updated committee with members\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "    pm.expect(jsonData).to.have.property('members');",
              "    pm.expect(jsonData.members).to.be.an('array');",
              "});",
              "",
              "pm.test(\"Member was added successfully\", function () {",
              "    const jsonData = pm.response.json();",
              "    const studentId = parseInt(pm.collectionVariables.get(\"student_id\"));",
              "    const wasAdded = jsonData.members.some(member => member.id === studentId);",
              "    pm.expect(wasAdded).to.be.true;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{committee_head_jwt}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"studentId\": {{student_id}}\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}/members",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}",
            "members"
          ]
        }
      },
      "response": []
    },
    {
      "name": "11. Verify Committee with Members",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/committees/{{committee_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "api",
            "committees",
            "{{committee_id}}"
          ]
        }
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "YOUR_AUTHENTICATED_JWT_TOKEN",
      "type": "string"
    },
    {
      "key": "president_jwt",
      "value": "YOUR_ACTIVITY_PRESIDENT_JWT_TOKEN",
      "type": "string"
    },
    {
      "key": "activity_id",
      "value": "1",
      "type": "string"
    },
    {
      "key": "committee_id",
      "value": "1",
      "type": "string"
    },
    {
      "key": "head_user_id",
      "value": "2",
      "type": "string"
    },
    {
      "key": "director_user_id",
      "value": "3",
      "type": "string"
    },
    {
      "key": "director_id",
      "value": "3",
      "type": "string"
    },
    {
      "key": "committee_head_jwt",
      "value": "YOUR_COMMITTEE_HEAD_JWT_TOKEN",
      "type": "string"
    },
    {
      "key": "search_query",
      "value": "john",
      "type": "string"
    },
    {
      "key": "student_id",
      "value": "4",
      "type": "string"
    }
  ]
}
