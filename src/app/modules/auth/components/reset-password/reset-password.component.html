<div class="reset-password-container">
  <div class="reset-password-card">
    <div class="reset-password-header">
      <h2>Reset Password</h2>
      <p>Enter your new password below</p>
    </div>

    <!-- Token Validation Loading -->
    <div *ngIf="!tokenValidated" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Validating reset link...</p>
    </div>

    <!-- Token Invalid -->
    <div *ngIf="tokenValidated && !isTokenValid" class="error-state">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p>{{ error }}</p>
      <a routerLink="/auth/forgot-password" class="back-link">Request new reset link</a>
    </div>

    <!-- Reset Password Form -->
    <form *ngIf="tokenValidated && isTokenValid" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
      <!-- Success Message -->
      <div *ngIf="success" class="success-message">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        {{ success }}
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="error-message">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ error }}
      </div>

      <!-- New Password Field -->
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <input
          type="password"
          id="newPassword"
          formControlName="newPassword"
          placeholder="Enter new password"
          [ngClass]="{ 'is-invalid': submitted && f['newPassword'].errors }"
        />
        <div *ngIf="submitted && f['newPassword'].errors" class="invalid-feedback">
          <div *ngIf="f['newPassword'].errors['required']">New password is required</div>
          <div *ngIf="f['newPassword'].errors['minlength']">Password must be at least 6 characters</div>
        </div>
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
          placeholder="Confirm new password"
          [ngClass]="{ 'is-invalid': submitted && f['confirmPassword'].errors }"
        />
        <div *ngIf="submitted && f['confirmPassword'].errors" class="invalid-feedback">
          <div *ngIf="f['confirmPassword'].errors['required']">Please confirm your password</div>
          <div *ngIf="f['confirmPassword'].errors['mustMatch']">Passwords do not match</div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button
          type="submit"
          [disabled]="loading"
          class="reset-password-btn"
        >
          <span *ngIf="!loading">Reset Password</span>
          <span *ngIf="loading" class="btn-loading">
            <div class="btn-spinner"></div>
            Resetting...
          </span>
        </button>
      </div>

      <!-- Back to Login -->
      <div class="back-to-login">
        <a routerLink="/auth/login" class="back-link">Back to Login</a>
      </div>
    </form>
  </div>
</div>
