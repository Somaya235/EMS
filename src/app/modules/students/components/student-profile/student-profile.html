<app-header></app-header>

<!-- Loading State -->
<div *ngIf="loading" class="text-center py-20 flex flex-col items-center gap-4">
  <div class="w-12 h-12 border-4 border-purple-200 border-t-violet-500 rounded-full animate-spin"></div>
  <p class="text-violet-600 text-lg">Loading student profile...</p>
</div>

<!-- Error State -->
<div *ngIf="error" class="text-center py-16 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl border-2 border-purple-300 my-8">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-500 mb-4">
    <circle cx="12" cy="12" r="10"></circle>
    <line x1="12" y1="8" x2="12" y2="12"></line>
    <line x1="12" y1="16" x2="12.01" y2="16"></line>
  </svg>
  <p class="text-purple-700 text-lg font-medium">{{ error }}</p>
</div>

<!-- Student Profile Content -->
<div *ngIf="!loading && !error" class="animate-fade-in">
  <ng-container *ngIf="student$ | async as student">
    <div class="bg-white rounded-3xl overflow-hidden shadow-[0_10px_40px_rgba(139,92,246,0.08)] border border-purple-200">
      <!-- Profile Image and Basic Info -->
      <div class="flex items-center gap-6 p-6 bg-gradient-to-br from-purple-50 to-purple-100 border-b border-purple-200 md:flex-col md:text-center md:gap-4 md:p-4 md:px-4">
        <div class="relative flex-shrink-0">
          <img [src]="student.profileImage || 'assets/images/default-avatar.svg'" [alt]="student.fullName" 
               class="w-[80px] h-[80px] rounded-full object-cover border-4 border-white shadow-[0_8px_24px_rgba(139,92,246,0.15)] transition-transform duration-300 hover:scale-105 md:w-[70px] md:h-[70px]"
               [class]="student.profileImage ? '' : 'w-16 h-16 opacity-80 bg-purple-100 p-4 rounded-full'">
        </div>
        
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-2 md:justify-center">
            <h1 class="text-2xl font-bold text-gray-900 m-0 leading-tight md:text-xl md:text-center">{{ student.fullName }}</h1>
            <!-- Edit Icon for Current User Profile -->
            <button class="bg-gradient-to-r from-blue-500 to-blue-600 border-none p-2 rounded-md cursor-pointer text-white transition-all duration-200 flex items-center justify-center shadow-[0_2px_8px_rgba(59,130,246,0.2)] hover:bg-gradient-to-r hover:from-blue-600 hover:to-blue-700 hover:scale-105 hover:shadow-[0_4px_12px_rgba(59,130,246,0.3)] active:scale-95" 
                    *ngIf="isCurrentUserProfile"
                    (click)="openEditDialog(student)"
                    title="Edit profile">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
          </div>
          <p class="text-violet-600 text-sm mb-3 break-words md:text-center">{{ student.email }}</p>
          <div class="flex gap-2 flex-wrap md:justify-center">
            <span class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-semibold shadow-[0_2px_8px_rgba(168,85,247,0.3)]" *ngIf="student.grade">{{ student.grade }}</span>
            <span class="bg-gradient-to-r from-violet-500 to-violet-600 text-white px-3 py-1 rounded-full text-xs font-semibold shadow-[0_2px_8px_rgba(139,92,246,0.3)]" *ngIf="student.major">{{ student.major }}</span>
          </div>
        </div>
      </div>

      <!-- Detailed Information -->
      <div class="p-10 bg-white md:p-8 md:px-6">
        <!-- Four Column Layout -->
        <div class="w-full overflow-x-auto">
<div class="flex flex-wrap gap-6 mb-10">
              <!-- Contact Information -->
            <div class="flex-shrink-0" style="width: 25%; min-width: 200px;">
              <h2 class="text-sm font-bold text-purple-900 mb-3 pb-1 border-b border-purple-200 flex items-center gap-1">
                <span class="w-1 h-4 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></span>
                Contact
              </h2>
              <div class="space-y-2">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Email</label>
                  <p class="text-purple-900 font-medium text-xs m-0 break-words">{{ student.email }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Phone</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.phoneNumber || 'Not provided' }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">National ID</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.nationalNumber || 'Not provided' }}</p>
                </div>
              </div>
            </div>

            <!-- Academic Information -->
            <div class="flex-shrink-0" style="width: 25%; min-width: 200px;">
              <h2 class="text-sm font-bold text-purple-900 mb-3 pb-1 border-b border-purple-200 flex items-center gap-1">
                <span class="w-1 h-4 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></span>
                Academic
              </h2>
              <div class="space-y-2">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Grade</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.grade || 'Not provided' }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">College ID</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.collageId || 'Not provided' }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Date of Birth</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.dateOfBirth ? (student.dateOfBirth | date:'longDate') : 'Not provided' }}</p>
                </div>
              </div>
            </div>

            <!-- Roles -->
            <div class="flex-shrink-0" style="width: 25%; min-width: 200px;" *ngIf="student.roles && student.roles.length > 0">
              <h2 class="text-sm font-bold text-purple-900 mb-3 pb-1 border-b border-purple-200 flex items-center gap-1">
                <span class="w-1 h-4 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></span>
                Roles
              </h2>
              <div class="flex flex-wrap gap-1">
                <span *ngFor="let role of student.roles" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-2 py-1 rounded-full text-xs font-semibold shadow-[0_2px_8px_rgba(168,85,247,0.3)] transition-all duration-300 hover:bg-gradient-to-r hover:from-purple-600 hover:to-purple-700 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(168,85,247,0.4)]">{{ role }}</span>
              </div>
            </div>

            <!-- Account Information -->
            <div class="flex-shrink-0" style="width: 25%; min-width: 200px;" *ngIf="student.createdAt">
              <h2 class="text-sm font-bold text-purple-900 mb-3 pb-1 border-b border-purple-200 flex items-center gap-1">
                <span class="w-1 h-4 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></span>
                Account
              </h2>
              <div class="space-y-2">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Created</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.createdAt | date:'longDate' }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Updated</label>
                  <p class="text-purple-900 font-medium text-xs m-0">{{ student.updatedAt | date:'longDate' }}</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-2 rounded border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
                  <label class="block text-xs font-semibold text-purple-700 mb-1 uppercase tracking-wider">Status</label>
                  <p class="font-semibold text-xs m-0" [class]="student.enabled ? 'text-green-600 bg-gradient-to-r from-green-50 to-green-100 px-2 py-1 rounded border border-green-300' : 'text-red-600 bg-gradient-to-r from-red-50 to-red-100 px-2 py-1 rounded border border-red-300'">
                    {{ student.enabled ? 'Active' : 'Inactive' }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-10" *ngIf="student.cvAttachment">
          <h2 class="text-xl font-bold text-purple-900 mb-6 pb-3 border-b-2 border-purple-200 flex items-center gap-2">
            <span class="w-1 h-6 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></span>
            Documents
          </h2>
          <div class="flex items-center gap-3 p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl border border-purple-200 transition-all duration-300 hover:bg-gradient-to-br hover:from-purple-100 hover:to-purple-200 hover:border-purple-500 hover:-translate-y-1 hover:shadow-[0_4px_12px_rgba(139,92,246,0.1)]">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-violet-500 flex-shrink-0">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            <a [href]="student.cvAttachment" target="_blank" class="text-violet-600 no-underline font-medium text-sm hover:text-violet-700 hover:underline">View CV</a>
          </div>
        </div>

      </div>
    </div>
  </ng-container>
  </div>

  <!-- Edit Profile Dialog -->
  <app-edit-profile-dialog
    [isVisible]="showEditDialog"
    [userData]="currentUserData"
    (close)="closeEditDialog()"
    (profileUpdated)="onProfileUpdated()"
  ></app-edit-profile-dialog>
