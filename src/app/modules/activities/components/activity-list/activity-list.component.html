<app-header></app-header>

<div class="max-w-7xl mx-auto p-8">
  <div class="text-left mb-6 p-0">
    <h1 class="text-2xl font-semibold bg-gradient-to-br from-indigo-500 to-purple-600 bg-clip-text text-transparent mb-1 tracking-tight">Student Activities</h1>
    <p class="text-gray-600 text-sm max-w-[400px] m-0 leading-relaxed">Discover and join exciting student activities</p>
  </div>

  <div class="flex justify-between items-start gap-8 mb-8 p-0">
    <div class="flex-0-0-auto min-w-[300px] relative">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Search activities..."
        class="w-full p-4 pl-14 border-2 border-gray-100 rounded-xl text-base transition-all duration-300 bg-gray-50 focus:outline-none focus:border-violet-500 focus:bg-white focus:shadow-[0_0_0_4px_rgba(139,92,246,0.15)] focus:-translate-y-px placeholder:text-gray-400"
      >
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-lg text-violet-500">üîç</span>
    </div>
    
    <div class="flex items-center gap-4 flex-wrap">
      <button class="flex items-center gap-3 p-4 px-8 bg-gradient-to-br from-violet-500 to-violet-600 text-white border-none rounded-xl text-base font-semibold cursor-pointer transition-all duration-300 whitespace-nowrap shadow-[0_6px_20px_rgba(139,92,246,0.3)] relative overflow-hidden hover:-translate-y-0.75 hover:shadow-[0_12px_30px_rgba(139,92,246,0.4)] active:-translate-y-0.25 active:shadow-[0_4px_15px_rgba(139,92,246,0.3)]" (click)="openCreateDialog()" *ngIf="isSuperAdmin()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="flex-shrink-0">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add Activity
      </button>
      
      <select [(ngModel)]="selectedCategory" (change)="onCategoryChange(selectedCategory)" class="p-4 px-12 pr-4 border-2 border-gray-100 rounded-xl bg-white text-sm font-medium min-w-[200px] appearance-none bg-[url('data:image/svg+xml,%3Csvg%20xmlns%3D%27http://www.w3.org/2000/svg%27%20width%3D%2716%27%20height%3D%2716%27%20viewBox%3D%270%200%2024%2024%27%20fill%3D%27none%27%20stroke%3D%27%238b5cf6%27%20stroke-width%3D%272%27%20stroke-linecap%3D%27round%27%20stroke-linejoin%3D%27round%27%3E%3Cpolyline%20points%3D%276%209%2012%2015%2018%209%27%3E%3C/polyline%3E%3C/svg%3E')] bg-no-repeat bg-right-4 bg-center cursor-pointer transition-all duration-300 focus:outline-none focus:border-violet-500 focus:shadow-[0_0_0_4px_rgba(139,92,246,0.15)] hover:border-gray-300 hover:-translate-y-px">
        <option value="all">All Categories</option>
        <option *ngFor="let category of categories" [value]="category.name">
          {{ category.name }}
        </option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center p-20 flex flex-col items-center gap-4">
    <div class="w-15 h-15 border-4 border-gray-100 border-t-violet-500 rounded-full animate-spin"></div>
    <p class="text-gray-600 text-lg">Loading activities...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="text-center p-16 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-300 my-8">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-500 mb-4">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <p class="text-red-600 text-lg font-medium">{{ error }}</p>
  </div>

  <!-- Activities Grid -->
  <div *ngIf="!loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 animate-fadeIn mt-0">
    <div 
      *ngFor="let activity of activities; let i = index" 
      class="bg-white rounded-2xl overflow-hidden shadow-[0_4px_20px_rgba(0,0,0,0.08)] transition-all duration-300 cursor-pointer opacity-100 translate-y-0 hover:-translate-y-2 hover:shadow-[0_12px_40px_rgba(0,0,0,0.15)]"
      (click)="viewActivityDetails(activity.id)"
    >
      <!-- Colored Header Section -->
      <div class="h-15 p-4 relative flex items-start justify-between" [style.background-color]="getCategoryColor(activity.category)">
        <div class="bg-white/90 text-gray-800 p-1.5 px-3 rounded-full text-xs font-semibold backdrop-blur-[10px] shadow-[0_2px_8px_rgba(0,0,0,0.1)] lowercase">
          {{ activity.category }}
        </div>
        <!-- Edit Icon - Only show for presidents -->
        <button 
          *ngIf="isCurrentUserPresident(activity)" 
          class="bg-white/90 border-none rounded-lg p-1.5 cursor-pointer transition-all duration-200 backdrop-blur-[10px] shadow-[0_2px_8px_rgba(0,0,0,0.1)] flex items-center justify-center hover:bg-white hover:-translate-y-0.25 hover:shadow-[0_4px_12px_rgba(0,0,0,0.15)]" 
          (click)="editActivity(activity, $event)"
          title="Edit Activity"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-800">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
      </div>
      
      <!-- Content Section -->
      <div class="p-4">
        <h3 class="text-lg font-bold text-gray-800 leading-tight mb-2">{{ activity.name }}</h3>
        <p class="text-gray-600 leading-relaxed mb-4 line-clamp-2 overflow-hidden text-sm min-h-[2.5em]">{{ activity.description }}</p>
        
        <!-- Stats Section -->
        <div class="flex gap-6 mb-4 items-center justify-between">
          <div class="flex flex-col items-start gap-0.5">
            <span class="text-xl font-bold text-gray-800 leading-none">{{ activity.memberCount || 0 }}</span>
            <span class="text-xs text-gray-600 font-medium lowercase">members</span>
          </div>
          
          <div class="flex flex-col items-start gap-0.5">
            <span class="text-xl font-bold text-gray-800 leading-none">{{ activitiesCount }}</span>
            <span class="text-xs text-gray-600 font-medium lowercase">events</span>
          </div>
          
          <!-- President Section -->
          <div class="flex items-center gap-3 pt-3 border-t border-gray-100">
            <div class="w-9 h-9 rounded-full bg-gradient-to-br from-violet-500 to-violet-600 text-white flex items-center justify-center font-semibold text-xs flex-shrink-0">
              {{ getPresidentInitials(getPresidentName(activity)) }}
            </div>
            <div class="flex flex-col gap-0.5 flex-1">
              <span class="text-sm font-semibold text-gray-800 leading-tight">{{ getPresidentName(activity) }}</span>
              <span class="text-xs text-gray-600 font-medium">President</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && activities.length === 0" class="text-center p-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-3xl border-2 border-dashed border-gray-300 my-8">
    <div class="text-gray-400 mb-6">
      <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
    </div>
    <h3 class="text-3xl font-bold text-gray-800 mb-3">No activities found</h3>
  </div>
</div>

<!-- Create Activity Dialog -->
<app-activity-create 
  *ngIf="showCreateDialog"
  (activityCreated)="onActivityCreated()"
  (dialogClosed)="closeCreateDialog()">
</app-activity-create>

<!-- Edit Activity Dialog -->
<app-edit-activity-dialog 
  *ngIf="showEditDialog"
  [activity]="selectedActivity"
  [isVisible]="showEditDialog"
  (close)="closeEditDialog()"
  (save)="saveActivity($event)">
</app-edit-activity-dialog>